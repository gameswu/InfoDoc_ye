# InfoDoc_ye

AstrBot Info与EULA管理插件

## 功能特性

- 🔐 **EULA管理**: 
  - 私聊：每个用户需要单独接受用户协议
  - 群聊：只需群内任意一位成员接受协议，整个群聊即可使用
- 📚 **信息查询**: 通过关键词快速获取相关信息页面链接
- 🛡️ **消息拦截**: 使用`on_decorating_result`钩子在发送消息前检查EULA状态，未接受协议时替换为EULA提醒
- 🎯 **智能识别**: 自动区分群聊和私聊，采用不同的EULA处理策略

## 使用方法

### EULA管理
- `/eula true` - 接受用户协议
  - **私聊**: 个人接受协议，只对当前用户生效
  - **群聊**: 为整个群聊接受协议，群内所有成员都可使用
- `/eula false` - 拒绝用户协议
  - **私聊**: 个人拒绝协议，无法使用机器人功能
  - **群聊**: 拒绝为群聊接受协议，群内无法使用机器人功能

### 信息查询
- `/info` - 查看所有可用关键词
- `/info [关键词]` - 获取对应信息页面链接

## EULA处理逻辑

### 私聊模式
- 每个用户需要单独接受EULA
- 用户状态以 `user_id` 为键存储
- 只有接受协议的用户才能使用机器人功能

### 群聊模式
- 群聊以 `group_id` 为单位管理EULA状态
- 只需群内任意一位成员执行 `/eula true`，整个群聊即被标记为已接受
- 群聊状态以 `group_{group_id}` 为键存储
- 一旦群聊接受协议，所有群成员都可以使用机器人功能

### 自动检测
- 插件会自动调用 `get_group_id()` 判断消息来源
- `group_id` 为 `None` 时识别为私聊
- `group_id` 有值时识别为群聊

## 技术实现

### 消息拦截机制
- 使用 `@filter.on_decorating_result()` 钩子在发送消息前进行EULA检查
- 当检测到未接受EULA时，清空原消息链并替换为EULA提醒消息
- 这种方式确保所有机器人回复都会经过EULA检查，无需在每个功能中重复检查

### 优势
- **统一拦截**: 所有插件的回复都会被统一检查，无遗漏
- **性能优化**: 避免在每个命令处理器中重复EULA检查逻辑
- **用户体验**: 用户发送任何消息都会得到适当的EULA提醒，而不是静默无响应

## 配置文件

- `info_links.yaml` - 存储关键词与链接的映射关系（位于插件目录）
- `user_eula_status.yaml` - 存储用户EULA接受状态（位于二级父目录，自动创建）

## 支持

[AstrBot帮助文档](https://astrbot.app)
